# JS - 어디까지 알고있나요 ?

#### JS의 Garbage Collection 메모리 관리

<div class="pull-right"> 문스코딩 - 2018.02.dd </div>

---

**용어정리**
```
    가비지 컬렌션 :: 필요없는 메모리를 정리하는 과정
```

#### 01. 메모리 관리

프로그래밍에서 메모리 관리한 항상 중요합니다
예전과 달리 메모리 처리에 많이 부담이 덜어졌지만,
프로그래머는 항상 사용자에게 최적의 환경을 제공해야 합니다.

자바스크립트는 메모리에 직접 접근하는 언어는 아닙니다.
사용한 메모리를 정리하는 Garbage Collection도 따로 제공하지 않습니다.
그래서 사용자가 메모리를 정리하기 위해선 직접 메모리를 지워야 합니다.

#### 02. 메모리의 생명 주기

Allocate memory => Use Memory => Release Memory

1. 메모리 할당 :: 프로그램이 사용할 수 이도록 운영체제가 메모리를 할당합니다.
    - 저수준의 언어는 이를 개발자가 명시적으로 처리해줍니다.
    - 고수준의 언어느 개발자가 이를 신경쓰지 않아도 됩니다.
2. 메모리 사용 :: 할당된 메모리를 실제로 프로그램이 사용하는 단계입니다.
    - 개발자가 필요에 따라 읽기와 쓰기 작업을 진행합니다.
3. 메로리 해제 :: 프로그램에서 필요하지 않은 메모리를 전체를 되돌려 주어 다시 사용가능하게 만드는 단계입니다.
    - 메모리 할당 작업과 마찬 가지로 저수준은 이를 명시합니다.

**javascript의 메모리 할당**

```js
var n = 374; // 숫자에 대한 메모리 할당
var s = 'sessionstack'; // 문자에 대한 메모리 할당
var o = {
  a: 1,
  b: null
}; // 객체 및 그 값에 대한 메모리 할당
var a = [1, null, 'str'];  // (객체와 같음) 배열과 그 값에 대한
                           // 메모리 할당
function f(a) {
  return a + 3;
} // 함수에 대한 할당(함수는 호출할 수 있는 객체임)
// 함수 표현식 또한 객체를 할당함
someElement.addEventListener('click', function() {
  someElement.style.backgroundColor = 'blue';
}, false);
```

#### 03. 가비지 컬렉션 (Garbage Collection)

Garbage Collection이란 사용이 완료된 메모리를 정리하는 것 입니다.
고수준의 언어에서는 이를 대부분 **가비지 컬렉터 (Garbage Collector)** 라는 내장된 소프트웨어가 진행합니다.
이것의 역할은 메모리 할당을 추적하고 언제 할당된 메모리가 더 이상 사용하지 않는지 파악해서 자동으로 반환하는 것입니다.
이러한 과정은 모두 추정에 의해서 기반하는데 일반적으로 메모리의 일부가 필요할지 알아내는 문제는 알고리즘으로 풀기 어렵기 때문입니다.

가비지 콜렉션 알고리즘의 핵심 개념은 참조입니다.
A라는 메모리를 통해 (명시적이든 암시적이든) B라는 메모리에 접근할 수 있다면 "B는 A에 참조된다" 라고 합니다.
예를 들어 모든 자바스크립트 오브젝트는 prototype 을 암시적으로 참조하고
그 오브젝트의 속성을 명시적으로 참조합니다.

참조가 하나도 없는 경우 가비지 컬렉션의 대상 (garbage collectible)으로 간주합니다.

**참조-세기(Reference-counting) 가비지 콜렉션**

```js
var o = {
  a: {
    b:2
  }
};
// 명백하게 가비지 콜렉션 수행될 메모리는 하나도 없습니다.

var o2 = o; // 'o2' 변수는 위의 오브젝트를 참조하는 두 번째 변수입니다.
o = 1;      // 이제 'o2' 변수가 위의 오브젝트를 참조하는 유일한 변수가 되었습니다.

var oa = o2.a; // 위의 오브젝트의 'a' 속성을 참조했습니다.
// 이제 'o2.a'는 두 개의 참조를 가집니다. 'o2'가 속성으로 참조하고 'oa'라는 변수가 참조합니다.

o2 = "yo";
// 이제 맨 처음 'o' 변수가 참조했던 오브젝트를 참조하는 오브젝트는 없습니다
// (역자: 참조하는 유일한 변수였던 o2에 다른 값을 대입)
// 이제 오브젝트에 가비지 콜렉션이 수행될 수 있을까요 ?
// NO ! 오브젝트의 'a' 속성이 여전히 'oa' 변수에 의해 참조되므로 메모리를 해제할 수 없습니다ㄴ.

oa = null;
// 'oa' 변수에 다른 값을 할당했습니다.
// 이제 맨 처음 'o' 변수가 참조했던 오브젝트를 참조하는 다른 변수는 없으므로 가비지 콜렉션이 수행됩니다.
```
> 즉 참조하는 값이 없다면 해당 메모리는 가비지 컬렉션이 수행되게 되는 것입니다.

#### 04. 참조 방식 예제

```js
let obj1 = new Sample(1)
let obj2 = new Sample(2)
let obj3 = new Sample(3)
let arrObj = [ obj1, obj2, obj3 ];

// 다음과 같은 상황에서 어떻게 처리할까요 ?
obj1 = null;    
console.log(arrObj[0]); // 삭제되지 않습니다. 참조값이 있기때문입니다.

// 만약 이 상태에서 배열의 참조값을 지우면 ? 데이터는 삭제될까요 ?
arrObj.splice(0, 1);

// 더 이상 참조되는 값이 없기 때문에 참조되지 않습니다.
```

#### 05. 순환 참조 때문에 생기는 문제

#### 06. 마크스위프 알고리즘

#### 07. 흔한 자바스크립트의 메모리 누수

1. 전역 변수 (window 객체)

2. 잊혀진 타이머 혹은 콜백함수

3. 클로저

4. DOM 에서 벗어난 요소 참조



---

**Created by SuperMoon**

**출처 : [SuperMoon's Git Blog](https://github.com/jm921106)**

[링크1 :: 가비지 컬렌션](https://engineering.huiseoul.com/%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%9E%91%EB%8F%99%ED%95%98%EB%8A%94%EA%B0%80-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EA%B4%80%EB%A6%AC-4%EA%B0%80%EC%A7%80-%ED%9D%94%ED%95%9C-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EB%88%84%EC%88%98-%EB%8C%80%EC%B2%98%EB%B2%95-5b0d217d788d)

[링크2 :: ]()


Copyright (c) 2017 Copyright Holder All Rights Reserved.
